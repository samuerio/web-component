define(["zepto", "wxsdk"], function($, wx) {
    var tip_tpl = '<div id="js-wx-tip-screen" class="mui-screen mask hide"><div class="mod-shareweixin"><div class="tip"><img class="tip-pyq" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACsAAAArCAYAAADhXXHAAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NTc3MiwgMjAxNC8wMS8xMy0xOTo0NDowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjQxMTY2M0ExOUFFRjExRTRCQTQ0QThDQjQ2ODczMTM4IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjQxMTY2M0EyOUFFRjExRTRCQTQ0QThDQjQ2ODczMTM4Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6NDExNjYzOUY5QUVGMTFFNEJBNDRBOENCNDY4NzMxMzgiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6NDExNjYzQTA5QUVGMTFFNEJBNDRBOENCNDY4NzMxMzgiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz4sqKSRAAAMzklEQVR42rRZ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"/><span>请点击右上角按钮，分享到朋友圈</span><img class="tip-arrow" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB0AAAAeCAYAAADQBxWhAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDIxIDc5LjE1NTc3MiwgMjAxNC8wMS8xMy0xOTo0NDowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTQgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjg4MjU3Mjk2OUFFRjExRTRCQ0Q1RUFGNTNDM0ZFREZFIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjg4MjU3Mjk3OUFFRjExRTRCQ0Q1RUFGNTNDM0ZFREZFIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6ODgyNTcyOTQ5QUVGMTFFNEJDRDVFQUY1M0MzRkVERkUiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6ODgyNTcyOTU5QUVGMTFFNEJDRDVFQUY1M0MzRkVERkUiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz596RQpAAABEklEQVR42uyVOwrCQBRFM9HGKo2FVoJWVuICtLdyD7oFcQ0ibkEtLRRRXEEW4AYEsfFT2AT8oKh53sCAhcRMJpPY5MJp8ubNYSbhhRGRpihNYIOh50pHqoAyuIILKHmtVyE0wJo+WfFnoUkZmNF3prwWirRN7mmFIa2C5w/pA1RUSrPgQN7Zg4wKaQKYJB6T9wSSdsl/OkGkdWBLSG3e61taABbJx+J7aLrgiEuBMTACjEmD75FigrO3DxqKZvSAKRj4bhswtwZd+0NiaSyNpZFKczJNSZCXFKZBz6V29pKuQ7jBzT/e6eJX0Rn4pFh4AkWwi+qkL/4L3EV1vVtQAxORr1c2N3AESzAHI3AXaXwLMAA48uFVor591AAAAABJRU5ErkJggg=="/></div></div></div>';
    var wx_share = {_init: function(url, callback) {
            $.ajax({url: "/api-bridge/weixin/ajax-wx-js-config",type: "POST",cache: false,dataType: "json",data: {url: url},success: function(r) {
                    if (r.ret === 0) {
                        var d = r.data;
                        callback.call(this, d)
                    }
                }})
        },share_tip: function() {
            var m = this;
            if (!m.tip) {
                m.tip = $(tip_tpl).on("click", function(e) {
                    m.tip.addClass("hide")
                });
                $("body").append(m.tip)
            }
            m.tip.removeClass("hide")
        },init: function(opt) {
            var m = this;
            m._init(opt.url, function(d) {
                var api_list = ["onMenuShareTimeline", "onMenuShareAppMessage", "onMenuShareQQ", "onMenuShareWeibo"];
                wx.config({debug: false,appId: d.appId,timestamp: d.timestamp,nonceStr: d.nonceStr,signature: d.signature,jsApiList: api_list});
                var wx_data = {title: opt.title,desc: opt.desc,link: opt.url,imgUrl: opt.pic,type: "link",dataUrl: "",success: function() {
                        m.tip.addClass("hide")
                    },cancel: function() {
                        m.tip.addClass("hide")
                    }};
                wx.ready(function() {
                    wx.onMenuShareTimeline(wx_data);
                    wx.onMenuShareAppMessage(wx_data);
                    wx.onMenuShareQQ(wx_data)
                })
            })
        },share: function(opt) {
            var m = this;
            m.share_tip()
        }};
    return wx_share
});
